# code-standard

尽管这是一篇讲规范的文档，但限于个人水平，还是可能有措辞不规范的地方，由此造成的误导敬请谅解。

不定期更新。

> 遇到不会的，我在哪学 C/C++？
>
> - 菜鸟教程：https://www.runoob.com/cplusplus/cpp-basic-syntax.html
> - learn X in Y minutes: https://learnxinyminutes.com/
> - C++ 标准库（做字典而不是教材）：https://en.cppreference.com/w/cpp/header
> - 个人不建议看书学习，尤其是 C++，C++ 是与时俱进的
>   - 学有余力的同学可以了解 C++11, C++13, C++17, C++20 等都有什么更新
> - 语法和方法不可能一次性学完，应该边写代码边学，遇到需求，再去寻找方法
> - 其他的学习渠道，欢迎补充；

1. `#include <iostream>` 是啥意思？

   - 就是把 `iostream.h` 文件里面的代码复制粘贴到你的代码里，其他的啥都没干；
   - 由于 `iostream.h` 文件里面定义了很多函数，你就可以用它们了；
   - 学有余力的同学可以了解多文件编程，定义自己的库 `.h` 和实现方法 `.cpp`。

2. `using namespace std;` 是啥意思？

   - 假设你自己定义了一个函数叫 `max`，但你用的库里面已经定义了 `max`，那就会产生冲突，或者说 `max` 这个名字已经被污染了；
   - 解决方法是分类，术语叫名字空间 `namespace`，
     - 比如 `cin` 就在 `std` 里面；
   - 更好的习惯其实是不写 `using namespace std`，而是写成 `std::cin`，
     - 因为 `using namespace std` 其实就相当于直接把分类融合了，很有可能污染你自己定义的函数；
     - 另一方面，我们需要知道一个函数的归属，`cin` 并不是你定义的，而是你 “借用” 的，这非常有利于别人读懂你的代码；
     - 学有余力的同学可以了解 `Python` 的 `import`

3. 结尾加不加分号的问题：

   - 语句结尾加分号；
   - `if`, `whlie`, `for` 和函数的大括号对是语句块，结尾不加分号；
   - `do ... while();` 需要加分号；
   - `return`, `break`, `continue` 加分号；
   - 结构体、类的定义的大括号对末尾要加分号。

4. `return 0;` 的问题：

   很多人似乎不理解 `return 0;` 的意义，写的千奇百怪。包括但不限于缺分号、给 0 加括号、不写等等。这些不规范的写法可能是从某个 PPT 或 CSDN 上抄下来的。

   - 学过 C/C++ 里面的函数就会知道，除返回 `void` 的函数外，函数必须要有返回值，由 `return` 传递。因此 `return 0;` 便代表 `int main()` 函数的返回值是 0；
   - `main()` 函数是程序的入口；
   - 在 C/C++ 中，0 表示程序正常退出，其他的值表示不正常退出，对机器来说也是有意义的（存疑，以官方文档为准）；
   - 由此可见，`main()` 函数返回的 0 是有意义的，因此不能不写 `return 0;`，更不能写成 `void main()`！

   以下构成一个最简单可运行的 C/C++ 代码：

   ```c++
   int main() {
       return 0;
   }
   ```

   - 学有余力的同学可以了解 `main()` 函数的参数（命令行参数，command-line arguments）

     ```C++
     int main(int argc, char* argv[], char* envp[]) {
         // ...
     	return 0;
     }
     ```

5. 参数的命名规范：

   - 命名用 **英文**，体现参数的实际含义，不要用 ~~拼音~~；
     - 在 UTF-8 编码的前提下，用 *中文* 或 *emoji* 命名变量都比 *拼音* 有 *更好的可读性*；
     - 注释可中文可英文，前提是编码一样，还是 UTF-8 吧；
     - 不知道编码概念的同学可以想一想 烫烫烫。
   - 慎用缩写，即使用缩写也要在定义后面注释全名；
   - `i, j, k` 用作循环中的计数器，不应用于其他变量的命名；
   - `x, y, z` 用作坐标，不应用于其他变量的命名；
   - 注重代码可读性，比如 `num_of_element` 就比 `n` 好得多；
   - 驼峰派和下划线派随意，统一命名风格就行；

6. 定义参数的地方：

   既然用了 `cin, cout`，你的代码就是 C++ 的，而不是 C，因此不存在把所有变量全定义在程序开头的要求（这可能是很老版本中 C 的规定了），你在哪第一次用，就在哪新定义；

   最好遵循最小作用域原则：变量应定义在最小作用域内

   - 变量 `p` 的最小作用域：包围所有 `p` 的最内层的大括号对。
   - 循环的计数器 `i` 如果不会在循环外再用到，则可用 C++ 的 for 循环（语法糖，C 没有）：

     ```c++
     for (int i = 0; i < n; i++)
     {
         // ...
     }
     // argument i undefined
     ```

   - **不要只定义不赋值就用参数**，谁知道编译器给你的默认值是什么啊。
     - 这也是不建议把变量定义在最开头的原因，定义和赋值写一起不好吗。

7. `for` 循环的问题：

   - `for` 括号内的三个语句
     - 最好只涉及同一个参数（一般是计数器功能）的初始化、判断和变化；
     - 语句尽可能简单，别在里面用逗号；
   - 尽量不要自作聪明地想着 “节约内存” 而把 `int` 写成 `char`，原因很简单：没必要！
     - 除非你是单片机的设计者，否则你就应该怎么方便怎么来；
     - 如果你确实有优化的癖好的话，那请先抓主要矛盾，优化你的算法比纠结用 `int` 还是 `char` 要有用的多；
   - 尽量不要自作聪明地想着 “这个计数器的范围应该是正的” 而加上 `unsigned`，一是没必要，二是你很有可能因此写出永远跳不出的死循环：

     ```c++
     for (unsigned char i = n; i >= 0; i--)
     {
         // i will never be negative...
     }
     ```

   - 尽量不要想着 `i++` 比 `++i` 多一次拷贝过程而想着优化成 `++i`，确实你很了解 `i++` 和 `++i` 的区别，但这在编译器眼里都一样；
   - 学有余力的同学可以了解迭代器，举一最简单的例子：

     ```c++
     int sum = 0;
     int numbers[] = { 1, 2, 3 };
     for (auto number : numbers)
     {
     	sum += number;
     }
     ```

     - 或者去了解 `Python` 的 `for` 循环。

8. 没必要省行数

   - 哲学是：一行只干一件事情，层次分明；
   - 所以 `if(...) ...` 和 `for(...) ...` 应该换行，写同一行往往只会降低可读性；

9. 格式化代码：缩进和空格

   - VS Code: Shift + Alt + F
   - VS: Ctrl + A, Ctrl + K, Ctrl + F
   - 运算符两边应留空格，这能很好的提升可读性，但很少有人做到这一点

10. 放弃 C 中的旧东西：

    - 既然用了 `cin, cout`，你的代码就是 C++ 的，而不是 C；
    - 放弃 `char[]`，用 `string`
      - 唯一的原因在于 `string` 更好用；
      - `string` 必然支持 `cin >> str` 读入，以空格为分界线；
      - 怎么读入一行带空格的句子呢？其中一种实现方法是：

        ```c++
        string word, sentense[100];
        int n;
        for (n = 0; cin.get() != '\n'; n++)
        {
            cin.unget();
            cin >> word;
            sentense[n] = word;
        }
        ```
      - 放弃 `strcat`, `strcmp`，用 `string` 可以进行 + 和 == 运算
      - 更多的 string 的 Member functions：https://en.cppreference.com/w/cpp/string/basic_string
    - 放弃 `NULL`，用 `nullptr`
    - （如果可以）放弃指针传参，用引用传参

11. 少用或者不用宏

    - 如果要定义常数，用 `const`

    - 如果要定义像

      ```C++
      #define MAX(x, y) (x) > (y) ? (x) : (y)
      ```

      这种可以接受不同参数类型的函数，C++ 有个概念叫模板，可以写成

      ```c++
      template <typename T>
      T max(T x, T y)
      {
          return x > y ? x : y;
      }
      ```

12. 如有错误或补充请及时指出，谢谢。

     
